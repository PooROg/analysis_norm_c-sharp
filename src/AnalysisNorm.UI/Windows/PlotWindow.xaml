<Window x:Class="AnalysisNorm.UI.Windows.PlotWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:oxy="http://oxyplot.org/wpf"
        Title="{Binding WindowTitle}" 
        Height="800" Width="1200" MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterOwner"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}">

    <Window.Resources>
        <!-- Стили для toolbar кнопок -->
        <Style x:Key="ToolbarButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignToolButton}">
            <Setter Property="Margin" Value="4,2"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Width" Value="36"/>
        </Style>
        
        <!-- Стили для toolbar текста -->
        <Style x:Key="ToolbarTextStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Margin" Value="8,0"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <!-- Toolbar с настройками графика -->
            <RowDefinition Height="Auto"/>
            <!-- Основная область графиков -->
            <RowDefinition Height="*"/>
            <!-- Статус-бар с информацией о данных -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar управления графиком -->
        <materialDesign:Card Grid.Row="0" 
                           Padding="8" 
                           Margin="8,8,8,4"
                           materialDesign:ElevationAssist.Elevation="Dp2">
            <StackPanel Orientation="Horizontal">
                
                <!-- Группа инструментов навигации -->
                <Border Background="{DynamicResource MaterialDesignToolBarBackground}"
                        CornerRadius="4" Padding="4" Margin="0,0,8,0">
                    <StackPanel Orientation="Horizontal">
                        <Button x:Name="ZoomInButton"
                                Style="{StaticResource ToolbarButtonStyle}"
                                Command="{Binding ZoomInCommand}"
                                ToolTip="Увеличить">
                            <materialDesign:PackIcon Kind="ZoomIn"/>
                        </Button>
                        
                        <Button x:Name="ZoomOutButton"
                                Style="{StaticResource ToolbarButtonStyle}"
                                Command="{Binding ZoomOutCommand}"
                                ToolTip="Уменьшить">
                            <materialDesign:PackIcon Kind="ZoomOut"/>
                        </Button>
                        
                        <Button x:Name="ZoomFitButton"
                                Style="{StaticResource ToolbarButtonStyle}"
                                Command="{Binding ZoomFitCommand}"
                                ToolTip="Подогнать к окну">
                            <materialDesign:PackIcon Kind="FitToPage"/>
                        </Button>
                        
                        <Separator Style="{StaticResource MaterialDesignVerticalSeparator}" Margin="4,0"/>
                        
                        <Button x:Name="PanButton"
                                Style="{StaticResource ToolbarButtonStyle}"
                                Command="{Binding TogglePanModeCommand}"
                                ToolTip="Режим панорамирования">
                            <materialDesign:PackIcon Kind="Pan"/>
                        </Button>
                        
                        <Button x:Name="ResetViewButton"
                                Style="{StaticResource ToolbarButtonStyle}"
                                Command="{Binding ResetViewCommand}"
                                ToolTip="Сбросить вид">
                            <materialDesign:PackIcon Kind="Refresh"/>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- Группа настроек отображения -->
                <Border Background="{DynamicResource MaterialDesignToolBarBackground}"
                        CornerRadius="4" Padding="4" Margin="0,0,8,0">
                    <StackPanel Orientation="Horizontal">
                        <CheckBox x:Name="ShowGridCheckBox"
                                  Content="Сетка"
                                  IsChecked="{Binding ShowGrid}"
                                  Style="{StaticResource MaterialDesignCheckBox}"
                                  Margin="4,0,8,0"/>
                                  
                        <CheckBox x:Name="ShowLegendCheckBox"
                                  Content="Легенда"
                                  IsChecked="{Binding ShowLegend}"
                                  Style="{StaticResource MaterialDesignCheckBox}"
                                  Margin="0,0,8,0"/>
                                  
                        <CheckBox x:Name="ShowTrendLineCheckBox"
                                  Content="Тренд"
                                  IsChecked="{Binding ShowTrendLine}"
                                  Style="{StaticResource MaterialDesignCheckBox}"
                                  Margin="0,0,4,0"/>
                    </StackPanel>
                </Border>

                <!-- Группа экспорта -->
                <Border Background="{DynamicResource MaterialDesignToolBarBackground}"
                        CornerRadius="4" Padding="4" Margin="0,0,8,0">
                    <StackPanel Orientation="Horizontal">
                        <Button x:Name="SaveImageButton"
                                Style="{StaticResource ToolbarButtonStyle}"
                                Command="{Binding SaveImageCommand}"
                                ToolTip="Сохранить как изображение">
                            <materialDesign:PackIcon Kind="FileImage"/>
                        </Button>
                        
                        <Button x:Name="CopyToClipboardButton"
                                Style="{StaticResource ToolbarButtonStyle}"
                                Command="{Binding CopyToClipboardCommand}"
                                ToolTip="Копировать в буфер обмена">
                            <materialDesign:PackIcon Kind="ContentCopy"/>
                        </Button>
                        
                        <Button x:Name="PrintButton"
                                Style="{StaticResource ToolbarButtonStyle}"
                                Command="{Binding PrintCommand}"
                                ToolTip="Печать">
                            <materialDesign:PackIcon Kind="Printer"/>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- Информация о масштабе -->
                <TextBlock x:Name="ZoomInfoTextBlock"
                          Text="{Binding ZoomInfo}"
                          Style="{StaticResource ToolbarTextStyle}"
                          Margin="8,0,0,0"/>

                <!-- Spacer -->
                <Border Width="1" Background="Transparent" HorizontalAlignment="Stretch"/>

                <!-- Кнопка закрытия -->
                <Button x:Name="CloseButton"
                        Style="{StaticResource MaterialDesignToolButton}"
                        Command="{Binding CloseCommand}"
                        ToolTip="Закрыть окно"
                        Margin="8,0,0,0">
                    <materialDesign:PackIcon Kind="Close"/>
                </Button>
            </StackPanel>
        </materialDesign:Card>

        <!-- Основная область с графиками -->
        <materialDesign:Card Grid.Row="1" 
                           materialDesign:ElevationAssist.Elevation="Dp1"
                           Margin="8,4,8,4">
            <Grid>
                <!-- Основной график OxyPlot -->
                <oxy:PlotView x:Name="MainPlotView" 
                             Model="{Binding PlotModel}"
                             Background="{DynamicResource MaterialDesignCardBackground}"
                             Margin="4"/>

                <!-- Overlay с дополнительной информацией -->
                <Border Background="Transparent"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Margin="16">
                    <materialDesign:Card Padding="8"
                                       materialDesign:ElevationAssist.Elevation="Dp4"
                                       Opacity="0.9"
                                       Visibility="{Binding ShowDataInfo, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="{Binding PlotTitle}" 
                                      FontWeight="SemiBold"
                                      Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding DataPointsCount, StringFormat='Точек данных: {0}'}" 
                                      FontSize="11"/>
                            <TextBlock Text="{Binding DataRange}" 
                                      FontSize="11"/>
                        </StackPanel>
                    </materialDesign:Card>
                </Border>

                <!-- Индикатор загрузки -->
                <Grid Background="{DynamicResource MaterialDesignCardBackground}"
                      Opacity="0.8"
                      Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel HorizontalAlignment="Center" 
                               VerticalAlignment="Center">
                        <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                    IsIndeterminate="True"
                                    Width="48" Height="48"
                                    Margin="0,0,0,16"/>
                        <TextBlock Text="Обновление графика..."
                                  Style="{StaticResource MaterialDesignBody2TextBlock}"
                                  HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </materialDesign:Card>

        <!-- Статус-бар с информацией -->
        <materialDesign:Card Grid.Row="2" 
                           Padding="8" 
                           Margin="8,4,8,8"
                           materialDesign:ElevationAssist.Elevation="Dp1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Основная информация -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Information" 
                                           Width="16" Height="16" 
                                           Margin="0,0,6,0"
                                           VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding StatusMessage}" 
                              Style="{StaticResource MaterialDesignCaptionTextBlock}"
                              VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Координаты курсора -->
                <StackPanel Grid.Column="1" 
                           Orientation="Horizontal" 
                           Margin="16,0">
                    <TextBlock Text="X:" 
                              Style="{StaticResource MaterialDesignCaptionTextBlock}"
                              Margin="0,0,4,0"/>
                    <TextBlock Text="{Binding CursorX, StringFormat='{}{0:F2}'}" 
                              Style="{StaticResource MaterialDesignCaptionTextBlock}"
                              MinWidth="60"
                              Margin="0,0,12,0"/>
                    <TextBlock Text="Y:" 
                              Style="{StaticResource MaterialDesignCaptionTextBlock}"
                              Margin="0,0,4,0"/>
                    <TextBlock Text="{Binding CursorY, StringFormat='{}{0:F2}'}" 
                              Style="{StaticResource MaterialDesignCaptionTextBlock}"
                              MinWidth="60"/>
                </StackPanel>

                <!-- Время последнего обновления -->
                <TextBlock Grid.Column="2" 
                          Text="{Binding LastUpdated, StringFormat='Обновлено: {0:HH:mm:ss}'}" 
                          Style="{StaticResource MaterialDesignCaptionTextBlock}"
                          Opacity="0.7"/>
            </Grid>
        </materialDesign:Card>
    </Grid>

</Window>