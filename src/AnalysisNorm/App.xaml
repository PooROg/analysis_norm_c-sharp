<!--App.xaml - ОБНОВЛЕННЫЙ для CHAT 3-4-->
<Application x:Class="AnalysisNorm.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             StartupUri="MainWindow.xaml">
    
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- Material Design -->
                <materialDesign:BundledTheme BaseTheme="Light" PrimaryColor="Blue" SecondaryColor="Orange" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Defaults.xaml" />
                
                <!-- НОВЫЕ стили для CHAT 3-4 -->
                <ResourceDictionary Source="Styles/ProcessingStepStyles.xaml" />
                <ResourceDictionary Source="Styles/DiagnosticAlertStyles.xaml" />
                <ResourceDictionary Source="Styles/ConfigurationStyles.xaml" />
                <ResourceDictionary Source="Styles/ExportStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- НОВЫЕ глобальные стили для CHAT 3-4 -->
            
            <!-- Стили для Processing Steps -->
            <Style x:Key="ProcessingStepItemStyle" TargetType="ListBoxItem">
                <Setter Property="Margin" Value="5,2" />
                <Setter Property="Padding" Value="10,5" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="BorderBrush" Value="{DynamicResource MaterialDesignDivider}" />
                <Setter Property="BorderThickness" Value="0,0,0,1" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ListBoxItem">
                            <Border Background="{TemplateBinding Background}" 
                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="4"
                                    Margin="{TemplateBinding Margin}"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource MaterialDesignSelection}" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource MaterialDesignDivider}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Стили для статусов -->
            <Style x:Key="StatusCompletedStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="Green" />
                <Setter Property="FontWeight" Value="SemiBold" />
            </Style>

            <Style x:Key="StatusInProgressStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="Orange" />
                <Setter Property="FontWeight" Value="SemiBold" />
            </Style>

            <Style x:Key="StatusErrorStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="Red" />
                <Setter Property="FontWeight" Value="SemiBold" />
            </Style>

            <!-- Стили для диагностических алертов -->
            <Style x:Key="AlertInfoStyle" TargetType="Border">
                <Setter Property="Background" Value="#E3F2FD" />
                <Setter Property="BorderBrush" Value="#2196F3" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="CornerRadius" Value="4" />
                <Setter Property="Padding" Value="10,5" />
                <Setter Property="Margin" Value="0,2" />
            </Style>

            <Style x:Key="AlertWarningStyle" TargetType="Border">
                <Setter Property="Background" Value="#FFF3E0" />
                <Setter Property="BorderBrush" Value="#FF9800" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="CornerRadius" Value="4" />
                <Setter Property="Padding" Value="10,5" />
                <Setter Property="Margin" Value="0,2" />
            </Style>

            <Style x:Key="AlertErrorStyle" TargetType="Border">
                <Setter Property="Background" Value="#FFEBEE" />
                <Setter Property="BorderBrush" Value="#F44336" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="CornerRadius" Value="4" />
                <Setter Property="Padding" Value="10,5" />
                <Setter Property="Margin" Value="0,2" />
            </Style>

            <!-- Стили для кнопок -->
            <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
                <Setter Property="Margin" Value="5" />
                <Setter Property="Padding" Value="15,8" />
                <Setter Property="Height" Value="36" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontWeight" Value="Medium" />
            </Style>

            <Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignOutlinedButton}">
                <Setter Property="Margin" Value="5" />
                <Setter Property="Padding" Value="15,8" />
                <Setter Property="Height" Value="36" />
                <Setter Property="FontSize" Value="14" />
            </Style>

            <Style x:Key="DangerButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
                <Setter Property="Margin" Value="5" />
                <Setter Property="Padding" Value="15,8" />
                <Setter Property="Height" Value="36" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Background" Value="#F44336" />
                <Setter Property="BorderBrush" Value="#F44336" />
                <Setter Property="Foreground" Value="White" />
            </Style>

            <!-- Стили для панелей статистики -->
            <Style x:Key="StatCardStyle" TargetType="materialDesign:Card">
                <Setter Property="Margin" Value="5" />
                <Setter Property="Padding" Value="15,10" />
                <Setter Property="materialDesign:ElevationAssist.Elevation" Value="Dp2" />
                <Setter Property="Background" Value="White" />
            </Style>

            <!-- Конвертеры для отображения -->
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            
            <!-- Конвертер для статусов processing steps -->
            <local:ProcessingStepStatusToIconConverter x:Key="ProcessingStepStatusToIconConverter" />
            <local:ProcessingStepStatusToColorConverter x:Key="ProcessingStepStatusToColorConverter" />
            
            <!-- Конвертер для диагностических алертов -->
            <local:DiagnosticAlertLevelToIconConverter x:Key="DiagnosticAlertLevelToIconConverter" />
            <local:DiagnosticAlertLevelToColorConverter x:Key="DiagnosticAlertLevelToColorConverter" />

            <!-- Анимации для UI -->
            <Storyboard x:Key="FadeInAnimation">
                <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                               From="0" To="1" Duration="0:0:0.3" />
            </Storyboard>

            <Storyboard x:Key="SlideInFromLeftAnimation">
                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)" 
                               From="-300" To="0" Duration="0:0:0.4">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>

            <!-- Progress Ring стиль -->
            <Style x:Key="CustomProgressRingStyle" TargetType="materialDesign:Card">
                <Setter Property="Width" Value="60" />
                <Setter Property="Height" Value="60" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="materialDesign:ElevationAssist.Elevation" Value="Dp0" />
            </Style>

            <!-- DataGrid стили -->
            <Style x:Key="ModernDataGridStyle" TargetType="DataGrid" BasedOn="{StaticResource MaterialDesignDataGrid}">
                <Setter Property="CanUserAddRows" Value="False" />
                <Setter Property="CanUserDeleteRows" Value="False" />
                <Setter Property="IsReadOnly" Value="True" />
                <Setter Property="AutoGenerateColumns" Value="False" />
                <Setter Property="GridLinesVisibility" Value="Horizontal" />
                <Setter Property="HorizontalGridLinesBrush" Value="{DynamicResource MaterialDesignDivider}" />
                <Setter Property="SelectionMode" Value="Single" />
                <Setter Property="SelectionUnit" Value="FullRow" />
                <Setter Property="AlternatingRowBackground" Value="{DynamicResource MaterialDesignBackground}" />
            </Style>

            <!-- TextBox стили -->
            <Style x:Key="ReadOnlyTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
                <Setter Property="IsReadOnly" Value="True" />
                <Setter Property="Background" Value="{DynamicResource MaterialDesignPaper}" />
                <Setter Property="Margin" Value="5" />
                <Setter Property="FontFamily" Value="Consolas" />
                <Setter Property="FontSize" Value="12" />
            </Style>

            <!-- Шаблоны данных -->
            <DataTemplate x:Key="ProcessingStepTemplate">
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Иконка статуса -->
                    <materialDesign:PackIcon Grid.Column="0" 
                                           Kind="{Binding Status, Converter={StaticResource ProcessingStepStatusToIconConverter}}"
                                           Foreground="{Binding Status, Converter={StaticResource ProcessingStepStatusToColorConverter}}"
                                           Width="20" Height="20" 
                                           VerticalAlignment="Center" 
                                           Margin="0,0,10,0" />

                    <!-- Описание -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Description}" 
                                 FontWeight="Medium" 
                                 TextWrapping="Wrap" />
                        <TextBlock Text="{Binding FormattedDuration}" 
                                 FontSize="11" 
                                 Foreground="{DynamicResource MaterialDesignBodyLight}"
                                 Visibility="{Binding EndTime, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </StackPanel>

                    <!-- Номер шага -->
                    <Border Grid.Column="2" 
                          Background="{DynamicResource MaterialDesignDivider}"
                          CornerRadius="10"
                          Width="20" Height="20"
                          VerticalAlignment="Center">
                        <TextBlock Text="{Binding StepNumber}" 
                                 HorizontalAlignment="Center" 
                                 VerticalAlignment="Center"
                                 FontSize="10"
                                 FontWeight="Bold" />
                    </Border>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="DiagnosticAlertTemplate">
                <Border Style="{Binding Level, Converter={StaticResource DiagnosticAlertLevelToStyleConverter}}"
                        Margin="0,2">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Иконка уровня -->
                        <materialDesign:PackIcon Grid.Column="0"
                                               Kind="{Binding Level, Converter={StaticResource DiagnosticAlertLevelToIconConverter}}"
                                               Width="16" Height="16"
                                               VerticalAlignment="Top"
                                               Margin="0,0,8,0" />

                        <!-- Содержимое -->
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="{Binding Title}" 
                                     FontWeight="SemiBold" 
                                     FontSize="13" />
                            <TextBlock Text="{Binding Message}" 
                                     TextWrapping="Wrap" 
                                     FontSize="12"
                                     Margin="0,2,0,0" />
                        </StackPanel>

                        <!-- Время -->
                        <TextBlock Grid.Column="2" 
                                 Text="{Binding Timestamp, StringFormat='{}{0:HH:mm}'}"
                                 FontSize="10"
                                 Foreground="{DynamicResource MaterialDesignBodyLight}"
                                 VerticalAlignment="Top" />
                    </Grid>
                </Border>
            </DataTemplate>

        </ResourceDictionary>
    </Application.Resources>
</Application>